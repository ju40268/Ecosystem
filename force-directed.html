<!DOCTYPE html>
<meta charset="utf-8">

<svg width="960" height="600"></svg>

<script src="https://d3js.org/d3.v4.min.js"></script>
<script>
    //    var nodes = [
    //        { id: "mammal", group: 0, label: "Mammals", level: 1 },
    //        { id: "dog"   , group: 0, label: "Dogs"   , level: 2 },
    //        { id: "cat"   , group: 0, label: "Cats"   , level: 2 },
    //        { id: "fox"   , group: 0, label: "Foxes"  , level: 2 },
    //        { id: "elk"   , group: 0, label: "Elk"    , level: 2 },
    //        { id: "insect", group: 1, label: "Insects", level: 1 },
    //        { id: "ant"   , group: 1, label: "Ants"   , level: 2 },
    //        { id: "bee"   , group: 1, label: "Bees"   , level: 2 },
    //        { id: "fish"  , group: 2, label: "Fish"   , level: 1 },
    //        { id: "carp"  , group: 2, label: "Carp"   , level: 2 },
    //        { id: "pike"  , group: 2, label: "Pikes"  , level: 2 }
    //    ]

    var width = window.innerWidth
    var height = window.innerHeight

    var svg = d3.select('svg')
    svg.attr('width', width).attr('height', height)

    d3.json("expertKnowledgeNodesType0AllEdges.json", function (error, data) {
        console.log(data)
        nodes = data.nodes
        links = data.links
        console.log(nodes)
        console.log(links)

        var linkForce = d3
            .forceLink()
//            .id(link => link.id)
                    //             for the force strength, make some changes
            .strength(link => Math.max(link.weight) - link.weight)

        // simulation setup with all forces
        var simulation = d3
            .forceSimulation()
//            .force('link', d3.forceLink())
//            .force('link', d3.forceLink().id(function(d) {
//                return d
//            })).strength()
            .force('link', linkForce)
            .force('charge', d3.forceManyBody().strength(-8))
            .force('center', d3.forceCenter(width / 2, height / 2))


        function getNodeColor(node) {
            if(node.risk > 0.66) return 'red'
            else if(node.risk > 0.33) return 'yellow'
            else return 'green'
        }
        function getLinkColor(link) {
            switch(link.type) {
                case 0:
                    return 'gray';
                    break;
                case 1:
                    return 'orange';
                    break;
                case 2:
                    return 'red';
                    break;
                case 6:
                    return 'gray';
                    break;
                case 4:
                    return 'blue';
                    break;
                case 5:
                    return 'purple';
                    break;
                case 3:
                    return 'cyan';
                    break;
            }
        }

        var linkElements = svg.append("g")
            .attr("class", "links")
            .selectAll("line")
            .data(links)
            .enter().append("line")
            .attr("stroke-width", 1)
//            .attr("stroke", "rgba(50, 50, 50, 0.2)")
            .attr("stroke", getLinkColor)

        var nodeElements = svg.append("g")
            .attr("class", "nodes")
            .selectAll("circle")
            .data(nodes)
            .enter().append("circle")
//            .attr("r", 10)
            .attr("fill", getNodeColor)
            .attr("r", function(d) { return d.value * 0.001; });//what you choose to size * ratio

        var textElements = svg.append("g")
            .attr("class", "texts")
            .selectAll("text")
            .data(nodes)
            .enter().append("text")
            .text(function (node) {
                if(node.value > 3000)
                    return  node.name
            })
            .attr("font-size", 15)
            .attr("dx", 15)
            .attr("dy", 4)

        simulation.nodes(nodes).on('tick', () => {
            nodeElements
            .attr('cx', function (node) { return node.x })
            .attr('cy', function (node) { return node.y })
        textElements
            .attr('x', function (node) { return node.x })
            .attr('y', function (node) { return node.y })
        linkElements
            .attr('x1', function (link) { return link.source.x })
            .attr('y1', function (link) { return link.source.y })
            .attr('x2', function (link) { return link.target.x })
            .attr('y2', function (link) { return link.target.y })
//        nodeElements.attr('transform', (d) => 'translate(' + d.x/2 + ',' + d.y/2 + ')')
    })
        simulation.force("link").links(links)
    })


</script>